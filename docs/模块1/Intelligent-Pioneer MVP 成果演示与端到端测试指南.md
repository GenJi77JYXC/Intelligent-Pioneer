# Intelligent-Pioneer MVP 成果演示与端到端测试指南

**版本:** v1.0
**日期:** [当前日期]

## 1. 🎯 演示目标

本指南旨在完整地演示 `Intelligent-Pioneer` 项目 MVP (最小可行产品) 的核心功能闭环。我们将通过模拟一个真实的运维场景，展示系统如何实现对终端问题的**自动发现、诊断、修复与状态监控**，全程无需人工干预后端流程。

## 2. 🛠️ 演示环境准备

在开始之前，请确保以下所有组件都已正确安装并处于运行状态。

> 如果是windows环境的话，make命令好像不行，后端服务就用go run 命令， docker就用 docker compose命令

| 组件                  | 状态         | 启动方式 / 访问地址                          |
| :-------------------- | :----------- | :------------------------------------------- |
| **后端服务 (Go)**     | ✅ **运行中** | 在项目根目录执行 `make run`                  |
| **依赖服务 (Docker)** | ✅ **运行中** | 在项目根目录执行 `make docker-up`            |
| **前端服务 (Vue)**    | ✅ **运行中** | 在前端项目目录执行 `pnpm dev`                |
| **Kibana (可选)**     | ✅ **运行中** | 浏览器访问 `http://localhost:5601`           |
| **PostgreSQL 客户端** | ✅ **已连接** | 连接到 `localhost:5432`，数据库 `pioneer_db` |
| **终端 Agent**        | ⬜️ **待启动** | 暂不启动，将在流程中启动                     |
| **Web 浏览器**        | ✅ **已打开** | 访问前端地址 `http://localhost:5173`         |

### 2.1. 关键数据准备

- **知识库条目:** 确保 Elasticsearch 中存在 ID 为 `dns-flush-kb` 的知识库条目。
- **环境清理 (可选):** 为了获得一个干净的演示环境，可以考虑：
    - 删除 PostgreSQL `agents` 表和 `workflows` 表中的所有数据。
    - 删除 Agent 本地的配置文件 `~/.intelligent-pioneer/agent_config.json`。

## 3. 🚀 演示流程 (Step-by-Step)

我们将模拟一个新 Agent 的上线、触发问题、系统自动修复、以及状态监控的全过程。

---

### **Part 1: Agent 上线与状态监控**

**目标:** 展示 Agent 的自动注册与实时状态监控能力。

**步骤 1.1: 启动 Agent**
1.  打开一个新的终端窗口。
2.  进入 `agent/` 目录。
3.  执行 `go run ./cmd/agent/main.go` 启动 Agent。
4.  **观察 Agent 终端日志:** 你会看到 "Agent not registered..."，然后成功注册并获取到一个 Agent ID，最后开始心跳和任务轮询。

**步骤 1.2: 在前端验证**
1.  **打开浏览器**，访问 `http://localhost:5173`，并登录到 `Intelligent-Pioneer` 的前端界面。
2.  导航到左侧菜单的 **“终端管理” -> “Agent 列表”**。
3.  **观察现象:**
    *   表格中应该**出现了一条新的 Agent 记录**，其主机名、IP 等信息与你启动 Agent 的机器一致。
    *   初始状态可能是 "offline"，但在 Agent 发送第一个心跳后（最多等待1分钟），状态会自动刷新为**绿色的“在线”**。
    *   “最后心跳时间”字段会**每分钟自动更新**。

**至此，我们验证了 Agent 的自动注册和平台对终端的实时状态感知能力。**

---

### **Part 2: 自动化工作流的触发与执行**

**目标:** 展示从问题触发到系统自动诊断、自动修复的完整无人值守流程。

**步骤 2.1: 触发任务**
1.  在前端界面，导航到 **“任务中心” -> “任务执行”** (或你命名的页面)。
2.  在“选择 Agent”的下拉框中，选择我们刚刚上线的那个**在线 Agent**。
3.  在“选择知识库”的下拉框中，选择 **“修复DNS缓存 (dns-flush-kb)”** 场景。
4.  点击**“执行”**按钮。

**步骤 2.2: 实时观测自动化流程**
1.  **观察前端事件时间线 (Timeline):**
    *   点击执行后，页面下方的 Timeline 会被激活。
    *   你会看到状态**实时地、自动地**向下推进，清晰地展示每一步：
        *   `[时间] - 工作流已创建 (pending)`
        *   `[时间] - 诊断任务已下发 (diagnosing)`
        *   ...

2.  **观察 Agent 终端日志:**
    *   你会看到 Agent 的长轮询结束，打印出 "New task received: ... Command=ping -c 1 baidu.com"。
    *   紧接着打印 "Executing command..." 和 "Task result posted successfully"。
    *   **几乎立刻**，下一次长轮询又会收到新的 "remediation" 任务，并再次执行和上报。

3.  **回到前端事件时间线，观察最终结果:**
    *   时间线会继续更新，展示诊断成功、修复任务下发、修复成功等状态。
    *   最终，时间线会停在**“工作流已完成 (completed)”**的状态。

**至此，我们验证了系统的核心价值：在无人干预的情况下，自动完成了对一个模拟问题的诊断和修复闭环。**

---

### **Part 3: 状态验证与数据溯源**

**目标:** 展示系统所有操作都有据可查，状态变更准确无误。

**步骤 3.1: 验证 Agent 离线检测**
1.  回到**启动 Agent 的终端窗口**。
2.  按下 `Ctrl+C` **停止 Agent**。
3.  回到前端的 **“Agent 列表”** 页面。
4.  **观察现象:**
    *   Agent 的“最后心跳时间”将不再更新。
    *   **持续观察页面**，根据你的配置（默认为5分钟超时，1分钟检查），在几分钟后，该 Agent 的状态会自动从**绿色的“在线”**变为**灰色的“离线”**。

**步骤 3.2: 在数据库中溯源**
1.  打开你的 **PostgreSQL 客户端**。
2.  查询 `workflows` 表 (`SELECT * FROM workflows;`)。
    *   你应该能看到一条我们刚刚执行过的工作流记录，其 `status` 字段为 `completed`，并记录了 `agent_id` 和 `kb_id`。
3.  查询 `agents` 表 (`SELECT * FROM agents;`)。
    *   你应该能看到 Agent 的 `status` 字段现在是 `offline`。

**至此，我们验证了系统的离线检测机制是有效的，并且所有关键操作都在数据库中有持久化的记录，便于审计和溯源。**

---

## 4. 结论

通过以上三个部分的完整演示，我们成功地证明了 `Intelligent-Pioneer` MVP 已经实现了其核心设计目标：一个能够**自动注册、实时监控、智能诊断和自动修复**的终端运维平台。这为项目后续的迭代（如引入 AI 预测、开发更复杂的工作流）奠定了坚实的基础。