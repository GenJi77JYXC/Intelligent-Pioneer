# Phase 1: 基础平台与知识库 MVP - 剩余任务

本文档旨在评估 `Intelligent-Pioneer` 项目 **Phase 1 (MVP)** 阶段的当前进度，并明确通往最终目标——“跑通第一个自动化案例”——的剩余任务清单。

## 🎯 Phase 1 核心目标回顾

**“能够现场演示一个完整的、端到端的自动化修复流程：在一个测试终端上手动模拟一个已知故障，系统能够自动发现、诊断、修复并报告，整个过程无需人工干预。”**

## 📊 当前进度评估 (Status Check)

我们已经成功地完成了所有**后端基础架构**的搭建工作，这是一个巨大的里程碑！这为后续的业务逻辑开发铺平了道路。

| 模块            | 子目标                       | 状态     | 备注                                                         |
| :-------------- | :--------------------------- | :------- | :----------------------------------------------------------- |
| **后端 (Go)**   | ✅ **基础服务搭建**           | **完成** | Gin, Viper, Zap 配置完毕。                                   |
|                 | ✅ **数据管道搭建**           | **完成** | PostgreSQL, Elasticsearch, Kafka 连接成功。                  |
|                 | ✅ **面向 Agent 的 API 框架** | **完成** | `/register`, `/heartbeat`, `/tasks` 等路由和空的 Handler 已创建。 |
|                 | ✅ **知识库引擎框架**         | **完成** | KB 数据结构已构思，手动触发 API 已创建。                     |
|                 | ⬜️ **核心业务逻辑实现**       | **待办** | **这是当前的主要差距所在。**                                 |
| **前端 (Vue3)** | ⬜️ **项目初始化**             | **待办** |                                                              |
|                 | ⬜️ **核心界面开发**           | **待办** | Agent列表页、事件流展示页。                                  |
| **Agent (Go)**  | ⬜️ **项目初始化与实现**       | **待办** |                                                              |

**结论:** 我们已经完成了大约 **50%** 的工作，主要是后端的基础设施建设。现在，我们需要将重心从“搭建骨架”转移到“填充血肉”，即实现真正的业务逻辑。

---

## 🚀 剩余任务清单 (Action Items)

以下是我们需要完成的、从现在到实现 MVP 目标的具体任务列表。

### 1. 后端业务逻辑实现 (最高优先级)

当前后端的 Handler 函数都是空的“模拟”实现。我们需要填充它们以驱动整个自动化流程。

-   **[ ] 任务 B1: 实现知识库引擎核心工作流 (`internal/core/engine`)**
    -   创建一个新的 `engine` 包。
    -   编写 `StartKBWorkflow` 函数，接收 `agent_id` 和 `kb_id`。
    -   实现**任务分发逻辑**：从 ES 读取 KB 条目，生成诊断任务，并将其放入一个待处理队列中（可以用一个 `map[string]chan Task` 来模拟，key 是 `agent_id`）。
    -   实现**结果处理逻辑**：当 Agent 上报诊断结果后，能够根据 KB 条目的 `analysis_logic` 进行判断，并决定是否下发修复指令。
    -   **关键:** 这是整个自动化流程的“大脑”，需要将“匹配 -> 诊断 -> 分析 -> 修复”的逻辑代码化。

-   **[ ] 任务 B2: 实现 Agent API 的真实逻辑 (`internal/api`)**
    -   **`RegisterAgent`:**
        -   接收 Agent 的 JSON 信息。
        -   生成唯一的 UUID (e.g., `google/uuid`)。
        -   将 Agent 信息存入 PostgreSQL (`store.DB`)。
        -   返回真实的 `agent_id`。
    -   **`Heartbeat`:**
        -   接收 `agent_id`。
        -   更新 PostgreSQL 中对应 Agent 的 `status` 和 `updated_at` 字段。
    -   **`GetTasks` (长轮询):**
        -   这是 Agent 与后端通信的关键。
        -   从任务队列中（**任务 B1** 中创建的队列）为指定的 `agent_id` 拉取任务。
        -   使用 Go `channel` 和 `select` 配合 `time.After` 来实现阻塞和超时。
    -   **`PostTaskResults`:**
        -   接收 Agent 上报的结果。
        -   将结果传递给**知识库引擎（任务 B1）**进行下一步处理。

### 2. 终端智能体 (Agent) 开发

我们需要一个能与后端交互的、真实的 Agent 客户端程序。

-   **[ ] 任务 A1: 创建 Agent 项目**
    -   在项目根目录下创建一个新的 `agent/` 目录。
    -   `cd agent` 并 `go mod init ...` 初始化一个新的 Go 模块。

-   **[ ] 任务 A2: 实现 Agent 核心功能**
    -   **启动与注册:** 实现 `main.go`，在启动时调用后端的 `/register` 接口，并保存 `agent_id`。
    -   **心跳与任务拉取:** 实现两个核心的 goroutine：一个定时发送心跳到 `/heartbeat`，另一个通过长轮询循环请求 `/tasks` 接口。
    -   **指令执行与结果上报:**
        -   当从 `/tasks` 获取到指令时，使用 `os/exec` 执行。
        -   捕获命令的输出、错误和退出码。
        -   将结果打包成 JSON，POST 到 `/tasks/results` 接口。

### 3. 前端界面开发 (用于演示)

为了完成最终的 Live Demo，我们需要一个简单的 Web 界面来触发和观察整个流程。

-   **[ ] 任务 F1: 初始化前端项目**
    -   在项目根目录下创建一个 `web/` 或 `frontend/` 目录。
    -   使用 Vite 创建一个 Vue3 + TypeScript 项目 (`npm create vite@latest`)。
    -   安装 Axios 和一个 UI 库 (如 Element Plus)。

-   **[ ] 任务 F2: 开发 Agent 列表页**
    -   创建一个页面，定期调用后端 API（未来需要创建），获取并展示所有已注册 Agent 的状态。

-   **[ ] 任务 F3: 开发事件流（Live Demo）页 (核心)**
    -   创建一个简单的表单，允许用户选择一个“在线”的 Agent 和一个要执行的“知识库场景”（例如，从后端 API 获取 KB 列表）。
    -   点击“执行”按钮，调用后端的 `/internal/trigger_kb` 接口。
    -   **关键:** 页面需要**定时轮询**一个后端 API (例如 `GET /api/v1/events/:task_id`)，获取任务的最新状态，并在一个时间线组件中实时展示出来，生动地呈现整个自动化流程。

## 🏆 MVP 完成的标志

当你可以在前端页面上点击一个按钮，然后清晰地看到：
1.  事件流中显示“任务已下发”。
2.  Agent 端（可以通过日志观察）接收到诊断指令并执行。
3.  事件流中显示“诊断完成”。
4.  Agent 端接收到修复指令并执行。
5.  事件流中最终显示“任务成功完成”。

**那一刻，你的 Phase 1 就圆满成功了！**

---

**建议的行动顺序:** **后端逻辑 (B1, B2) -> Agent 开发 (A1, A2) -> 前端开发 (F1, F2, F3)**。因为 Agent 和前端都依赖于后端提供可用的 API。